
<!-- Javascript Start -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<!-- Custom Theme JavaScript -->
<!--* Start Bootstrap - Grayscale Bootstrap Theme (http://startbootstrap.com)
* Code licensed under the Apache License v2.0.
* For details, see http://www.apache.org/licenses/LICENSE-2.0.-->
<script>
// Enhanced navbar scroll animation
function handleNavbarScroll() {
  const navbar = $(".navbar-fixed-top");
  const scrollTop = $(window).scrollTop();
  const threshold = 50;
  
  if (scrollTop > threshold) {
    navbar.addClass("top-nav-collapse");
  } else {
    navbar.removeClass("top-nav-collapse");
  }
  
  // Add scrolling class for micro-interactions
  if (scrollTop > 10) {
    navbar.addClass("navbar-scrolling");
  } else {
    navbar.removeClass("navbar-scrolling");
  }
}

// Debounced scroll handler for better performance
let ticking = false;
function requestTick() {
  if (!ticking) {
    requestAnimationFrame(handleNavbarScroll);
    ticking = true;
  }
}

function finishTick() {
  ticking = false;
}

$(document).ready(function() {
  handleNavbarScroll();
  
  // Enhanced scroll event with requestAnimationFrame for smooth performance
  $(window).scroll(function() {
    requestTick();
    setTimeout(finishTick, 16); // ~60fps
  });
  
  // Smooth scroll with enhanced easing
  $("a.page-scroll").bind("click", function(e) {
    const target = $(this);
    const href = target.attr("href");
    const offsetTop = $(href).offset().top - 60; // Account for navbar height
    
    $("html, body").stop().animate({
      scrollTop: offsetTop
    }, 1200, "easeInOutExpo", function() {
      target.blur();
    });
    
    e.preventDefault();
  });
  
  // Auto-collapse mobile menu on item click
  $(".navbar-collapse ul li a").click(function() {
    const toggle = $(".navbar-toggle:visible");
    if (toggle.length) {
      toggle.click();
    }
  });
  
  // Add hover effects to navbar items
  $(".navbar-nav li a").hover(
    function() {
      $(this).addClass("nav-hover");
    },
    function() {
      $(this).removeClass("nav-hover");
    }
  );
  
  // Theme toggle animation enhancement
  $("#theme-toggle").on("click", function() {
    $(this).addClass("theme-switching");
    setTimeout(() => {
      $(this).removeClass("theme-switching");
    }, 400);
  });
  
  // Universal scroll-to-top functionality
  $(".scroll-to-top").on("click", function(e) {
    e.preventDefault();
    $("html, body").animate({
      scrollTop: 0
    }, 800, "easeInOutExpo");
  });
  
  // Show/hide scroll-to-top button based on scroll position
  $(window).scroll(function() {
    const scrollTop = $(window).scrollTop();
    const button = $(".scroll-to-top");
    
    if (scrollTop > 200) {
      button.addClass("visible");
    } else {
      button.removeClass("visible");
    }
  });
});
</script>

{% if page.section-type == "index" %}

  <!-- Collapse navbar when navbar-brand is clicked -->

  <script>
  $(function(){$(".navbar-brand").click(function(){$(".collapse.in")&&$(".collapse.in").animate({height:"1px"},500,function(){$(".collapse.in").removeClass("in")})})});
  </script>

{% endif %}

{% if site.syntax-highlight and page.section-type == "post" %}

  <!-- Syntax highlight in post pages-->

  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

{% endif %}

{% if jekyll.environment == "production" %}
  {% if site.google-tracking-id %}

  <!-- Google Tracking Id Start -->

  <!-- Google Analytics 4 (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google-tracking-id }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ site.google-tracking-id }}');
  </script>

  <!-- Google Tracking Id End -->

  {% endif %}
{% endif %}

{% if site.disqus-shortname and jekyll.environment == "production" %}

  <!-- Disqus -->

  {% if page.section-type == "post" %}

    <script type="text/javascript">
    var disqus_shortname = '{{ site.disqus-shortname }}';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>

  {% endif %}

  {% if page.section-type == "post" or page.section-type == "blog" or page.section-type == "index" or page.section-type == "tag" %}

    <!-- Comments Counter Start -->

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = '{{ site.disqus-shortname }}'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

    <!-- Comments Counter End -->

  {% endif %}

{% endif %}

{% if page.section-type == "post" %}

  <!-- Share buttons Start -->

  <script src="{{site.baseurl}}/js/rrssb.min.js"></script>

  <!-- Share buttons End -->

{% endif %}

{% if site.dynamic-typing and page.section-type == "index" %}

  <!-- Dynamic Typing Start -->

  <script type="text/javascript" src="{{site.baseurl}}/js/typed.min.js"></script>
  <script type="text/javascript">

  var myQuotes =  new Array();
  {% for line in site.lines %}
    myQuotes.push("{{ line.text }}");
  {% endfor %}

  function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex ;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }

  {% if site.shuffle %}
    shuffle(myQuotes)
  {% endif %}

    $(".intro-text").typed({
      strings: myQuotes,
      typeSpeed: {{ site.type-speed }},
      backDelay: {{ site.delete-delay }},
      startDelay: {{ site.start-delay }},
      loop: {{ site.loop }},
      loopCount: {{ site.loop-count }},
      cursorChar: "|"
    });
  </script>

  <!-- Dynamic Typing End  -->

{% endif %}

<script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, '{{page.title}}', '{{site.url}}{{site.baseurl}}{{page.url}}');
  }
}
</script>

<!-- Gesture Navigation / Swipe Instruction Start -->
{% if site.enable-gesture-navigation %}

  {% if page.section-type == "post" %}

    <!-- Post Gesture Navigation Start -->

    <script type="text/javascript" src="{{site.baseurl}}/js/hammer.min.js"></script>

    <script>
      var post = document.getElementById('post');

      new Hammer(post).on('swipeleft', function(event) {
        addTohistory();
        {% if site.baseurl == "" and page.previous == nil %}
          document.location.replace("/");
        {% else %}
          document.location.replace("{{site.baseurl}}{{page.previous.url}}");
        {% endif %}
      });

      new Hammer(post).on('swiperight', function(event) {
        addTohistory();
        {% if site.baseurl == "" and page.next == nil %}
          document.location.replace("/");
        {% else %}
          document.location.replace("{{site.baseurl}}{{page.next.url}}");
        {% endif %}
      });
    </script>

    <!-- Post Gesture Navigation Start -->

  {% endif %}

  {% if page.section-type == "blog" %}

    <!-- Blog Gesture Navigation Start -->

    <script type="text/javascript" src="{{site.baseurl}}/js/hammer.min.js"></script>

    <script>
      var page = document.getElementById('page');

      new Hammer(page).on('swipeleft', function(event) {
        addTohistory();
        {% if site.baseurl == "" and paginator.next_page_path == nil %}
          document.location.replace("/");
        {% else %}
          document.location.replace("{{site.baseurl}}{{paginator.next_page_path}}");
        {% endif %}
      });
      new Hammer(page).on('swiperight', function(event) {
        addTohistory();
        {% if site.baseurl == "" and paginator.previous_page_path == nil %}
          document.location.replace("/");
        {% else %}
          document.location.replace("{{site.baseurl}}{{paginator.previous_page_path}}");
        {% endif %}
      });
    </script>

    <!-- Blog Gesture Navigation Start -->

  {% endif %}

  {% if page.section-type == "blog" %}

    <!-- Swipe Instructions for Blog Start -->

    <script>
      $(document).ready(function(){
        if(!localStorage.getItem('blog-swipeshowed')){
          $("#swipe-instruction").fadeIn();
          $("#swipe-instruction .close-swipe-instruction").click(function(){
            $("#swipe-instruction").fadeOut();
          });
          localStorage.setItem('blog-swipeshowed', true);
        }
      });
    </script>

    <!-- Swipe Instructions for Blog End -->

  {% endif %}

  {% if page.section-type == "post" %}

    <!-- Swipe Instructions for Post Start -->

    <script>
      $(document).ready(function(){
        if(!localStorage.getItem('post-swipeshowed')){
          $("#swipe-instruction").fadeIn();
          $("#swipe-instruction .close-swipe-instruction").click(function(){
            $("#swipe-instruction").fadeOut();
          });
          localStorage.setItem('post-swipeshowed', true);
        }
      });
    </script>

    <!-- Swipe Instructions for Post End -->

  {% endif %}

<!-- Gesture Navigation / Swipe Instruction End -->

{% endif %}

<!-- Theme Toggle Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');
  const body = document.body;
  
  // Navigation scroll illusion for external pages
  initNavigationScrollIllusion();
  
  // Initialize theme from localStorage or default to dark
  const savedTheme = localStorage.getItem('theme') || 'dark';
  setTheme(savedTheme);
  
  function setTheme(theme) {
    if (theme === 'light') {
      body.setAttribute('data-theme', 'light');
      themeIcon.className = 'fa fa-sun theme-icon';
      localStorage.setItem('theme', 'light');
    } else {
      body.removeAttribute('data-theme');
      themeIcon.className = 'fa fa-moon theme-icon';
      localStorage.setItem('theme', 'dark');
    }
  }
  
  function toggleTheme() {
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    
    // Add a small animation to the toggle button
    themeToggle.style.transform = 'rotate(180deg)';
    setTimeout(() => {
      themeToggle.style.transform = 'rotate(0deg)';
    }, 300);
  }
  
  // Theme toggle event listener
  themeToggle.addEventListener('click', toggleTheme);
  
  // Keyboard accessibility
  themeToggle.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleTheme();
    }
  });
  
  function initNavigationScrollIllusion() {
    // Only run on index page (check for intro section and page-top id)
    if (document.getElementById('page-top') && document.querySelector('.intro')) {
      
      // Define navigation order and corresponding sections
      const navigationOrder = [
        { name: 'About', section: '#about', external: false },
        { name: 'Blog', section: '#latest-post', external: false },
        { name: 'Setup', section: '#setup-preview', external: true, url: '/setup/' },
        { name: 'Timeline', section: '#timeline', external: false },
        { name: 'Contact', section: '#contact-page', external: true, url: '/contact/' }
      ];
      
      // Add click handlers to external navigation links
      document.addEventListener('click', function(e) {
        const link = e.target.closest('a');
        if (!link) return;
        
        const href = link.getAttribute('href');
        // Get base URL from Jekyll config or default to empty
        const baseUrl = '{{ site.baseurl }}';
        
        // Check if this is an external navigation link (Setup or Contact)
        const externalNav = navigationOrder.find(nav => 
          nav.external && href && (href.includes(nav.url) || href.endsWith(nav.url))
        );
        
        if (externalNav && link.closest('.navbar-nav')) {
          e.preventDefault();
          performScrollIllusion(externalNav, href);
        }
      });
    }
  }
  
  function performScrollIllusion(targetNav, finalUrl) {
    // Determine current scroll position and target direction
    const currentScroll = window.pageYOffset;
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    
    // Calculate relative position on page (0 = top, 1 = bottom)
    const scrollProgress = currentScroll / (documentHeight - windowHeight);
    
    // Determine scroll direction based on navigation position and current location
    let scrollDirection, scrollDistance;
    
    if (targetNav.name === 'Setup') {
      // Setup is in middle position (3/5)
      if (scrollProgress < 0.4) {
        // User is in top half, scroll down towards setup area
        scrollDirection = 'down';
        scrollDistance = windowHeight * 1.5;
      } else {
        // User is in bottom half, scroll up towards setup area
        scrollDirection = 'up';
        scrollDistance = windowHeight * 1.2;
      }
    } else if (targetNav.name === 'Contact') {
      // Contact is last, always scroll down
      scrollDirection = 'down';
      scrollDistance = windowHeight * 2;
    }
    
    // Create smooth scroll illusion
    const startScroll = currentScroll;
    const targetScroll = scrollDirection === 'down' 
      ? Math.min(startScroll + scrollDistance, documentHeight - windowHeight)
      : Math.max(startScroll - scrollDistance, 0);
    
    // Add loading overlay for better UX
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(var(--ctp-base-rgb, 30, 30, 46), 0.8);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ctp-text, #cdd6f4);
      font-family: monospace;
      opacity: 0;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(4px);
    `;
    overlay.innerHTML = `
      <div style="text-align: center;">
        <div style="font-size: 18px; margin-bottom: 10px;">Navigating to ${targetNav.name}...</div>
        <div style="width: 200px; height: 2px; background: rgba(var(--ctp-mauve-rgb, 203, 166, 247), 0.3); border-radius: 1px; overflow: hidden;">
          <div style="width: 0%; height: 100%; background: var(--ctp-mauve, #cba6f7); border-radius: 1px; animation: loadingBar 1.2s ease-out forwards;"></div>
        </div>
      </div>
    `;
    
    // Add loading animation CSS
    const style = document.createElement('style');
    style.textContent = `
      @keyframes loadingBar {
        0% { width: 0%; }
        100% { width: 100%; }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(overlay);
    
    // Fade in overlay
    requestAnimationFrame(() => {
      overlay.style.opacity = '1';
    });
    
    // Animate scroll with easing
    const duration = 800;
    const startTime = performance.now();
    
    function animateScroll(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // Easing function (ease-out-cubic)
      const easeProgress = 1 - Math.pow(1 - progress, 3);
      
      const currentPosition = startScroll + (targetScroll - startScroll) * easeProgress;
      window.scrollTo(0, currentPosition);
      
      if (progress < 1) {
        requestAnimationFrame(animateScroll);
      } else {
        // Scroll complete, navigate to external page
        setTimeout(() => {
          window.location.href = finalUrl;
        }, 200);
      }
    }
    
    // Start scroll animation after a brief delay
    setTimeout(() => {
      requestAnimationFrame(animateScroll);
    }, 100);
  }
  
});
</script>

<!-- Javascript End -->
