---
import BaseLayout from '../layouts/BaseLayout.astro';
import { supportLinks } from '../data/site';

type SupportMeta = {
  lane: string;
  commitment: string;
  command: string;
  recommended?: boolean;
};

const supportMetaByLabel: Record<string, SupportMeta> = {
  'Buy Me a Coffee': {
    lane: 'One-time',
    commitment: 'One-time or monthly',
    command: 'coffee'
  },
  'GitHub Sponsors': {
    lane: 'Monthly',
    commitment: 'Recurring sponsorship',
    command: 'sponsor',
    recommended: true
  }
};

const defaultSupportMeta: SupportMeta = {
  lane: 'Optional',
  commitment: 'Optional support',
  command: 'support'
};

const supportChannels = supportLinks.map((link) => ({
  ...link,
  ...(supportMetaByLabel[link.label] ?? defaultSupportMeta),
  external: link.href.startsWith('http')
}));

const oneTimeRoute = supportChannels.find((channel) => channel.lane === 'One-time');
const monthlyRoute = supportChannels.find((channel) => channel.lane === 'Monthly');

const supportImpact = [
  {
    label: 'Lab costs',
    detail: 'Offsets hosting, hardware, and homelab rebuild costs behind the examples.',
    lane: '/infra'
  },
  {
    label: 'Writing time',
    detail: 'Creates room to turn rough incident notes into practical, searchable docs.',
    lane: '/docs'
  },
  {
    label: 'Open source upkeep',
    detail: 'Supports maintenance, issue triage, and updates across active repos.',
    lane: '/oss'
  }
];
---

<BaseLayout
  title="Support"
  description="Support TechDufus if the content helped. Everything stays free, and support is optional."
>
  <section class="hero-surface hero-grid-lines support-hero-celebrate reveal reveal-delay-1">
    <span class="support-hero-glint" aria-hidden="true"></span>
    <p class="eyebrow">Support</p>
    <h1 class="hero-title">Keep the notes free. Support if it feels worth it.</h1>
    <p class="mt-4 max-w-2xl text-zinc-300">
      Every post and doc on this site stays free. No paywall and no premium tier. Support is optional, and it helps me
      keep publishing practical writeups from real platform work.
    </p>
    <div class="mt-5 flex flex-wrap gap-2">
      {oneTimeRoute && (
        <a
          class="contact-quick-link"
          href={oneTimeRoute.href}
          target={oneTimeRoute.external ? '_blank' : undefined}
          rel={oneTimeRoute.external ? 'noopener noreferrer' : undefined}
        >
          One-time support -> {oneTimeRoute.label}
        </a>
      )}
      {monthlyRoute && (
        <a
          class="contact-quick-link"
          href={monthlyRoute.href}
          target={monthlyRoute.external ? '_blank' : undefined}
          rel={monthlyRoute.external ? 'noopener noreferrer' : undefined}
        >
          Monthly support -> {monthlyRoute.label}
        </a>
      )}
    </div>
  </section>

  <section class="content-section">
    <div class="section-head">
      <h2>Choose your support lane</h2>
      <p>Pick whichever platform you already trust.</p>
    </div>

    <div class="grid gap-3 sm:grid-cols-2">
      {supportChannels.map((channel, index) => (
        <a
          class:list={[
            'interactive-card card-link-block p-5 contact-grid-card contact-card-support',
            'reveal support-route-card support-sheen-card',
            channel.recommended && 'contact-grid-card-spotlight'
          ]}
          href={channel.href}
          target={channel.external ? '_blank' : undefined}
          rel={channel.external ? 'noopener noreferrer' : undefined}
          data-depth={channel.recommended ? 'signature' : undefined}
          style={`--support-stagger: ${160 + index * 90}ms; animation-delay: var(--support-stagger);`}
        >
          <span class="support-card-sheen" aria-hidden="true"></span>
          <div class="flex items-start justify-between gap-2">
            <p class="font-mono text-xs uppercase tracking-[0.14em] text-signal">{channel.label}</p>
            <span class:list={['contact-priority', channel.recommended && 'contact-priority-primary']}>
              {channel.recommended ? 'most sustainable' : 'optional'}
            </span>
          </div>
          <p class="mt-1 text-sm font-medium text-zinc-100">{channel.lane} support</p>
          <p class="mt-2 text-sm leading-relaxed text-zinc-300">{channel.details}</p>
          <div class="mt-3 flex flex-wrap gap-1.5">
            <span class="contact-pill">{channel.commitment}</span>
            <span class="contact-pill">/{channel.command}</span>
          </div>
          <span class="contact-quick-link mt-4 inline-flex">Open {channel.label} -></span>
        </a>
      ))}
    </div>
  </section>

  <section class="content-section">
    <div class="section-head">
      <h2>What support enables</h2>
      <p>Directly funds the work that keeps this site useful.</p>
    </div>

    <div class="grid gap-3 md:grid-cols-3">
      {supportImpact.map((item, index) => (
        <article
          class="interactive-card metric-card p-4 reveal support-impact-card support-sheen-card"
          style={`--support-stagger: ${340 + index * 90}ms; animation-delay: var(--support-stagger);`}
        >
          <span class="support-card-sheen" aria-hidden="true"></span>
          <p class="m-0 font-mono text-[11px] uppercase tracking-[0.12em] text-signal">{item.label}</p>
          <p class="m-0 mt-2 text-sm leading-relaxed text-zinc-300">{item.detail}</p>
          <p class="terminal-strip mt-3 inline-flex">{item.lane}</p>
        </article>
      ))}
    </div>
  </section>

  <section
    class="content-section panel compact-panel p-5 reveal support-closing-card support-sheen-card"
    style="--support-stagger: 520ms; animation-delay: var(--support-stagger);"
  >
    <span class="support-card-sheen" aria-hidden="true"></span>
    <div class="section-head">
      <h2>No pressure policy</h2>
      <p>Everything here stays free either way.</p>
    </div>
    <p class="m-0 max-w-3xl text-sm leading-relaxed text-zinc-300">
      No paywall, no premium tier, and no gated docs. If support feels worth it, I appreciate it. If not, keep using
      the posts and docs exactly the same way.
    </p>
    <div class="mt-4 flex flex-wrap gap-2">
      <a class="nav-link nav-link-active" href="/blog">Read latest posts</a>
      <a class="nav-link" href="/docs">Browse docs</a>
    </div>
  </section>
</BaseLayout>
