#!/bin/bash

# Create a new Astro blog post under src/content/blog.
# Usage: ./scripts/newpost "Your Post Title"

set -euo pipefail

POSTS_DIR="src/content/blog"
POST_TITLE="${1:-}"

if [ -z "$POST_TITLE" ]; then
  echo "Error: Please provide a post title"
  echo "Usage: ./scripts/newpost \"Your Post Title\""
  exit 1
fi

DATE=$(date +%Y-%m-%d)

FILENAME=$(echo "$POST_TITLE" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9]/-/g' | sed 's/--*/-/g' | sed 's/^[-]*//; s/[-]*$//')
mkdir -p "$POSTS_DIR"
FILEPATH="$POSTS_DIR/$FILENAME.md"

if [ -f "$FILEPATH" ]; then
  echo "Error: Post file already exists: $FILEPATH"
  exit 1
fi

cat > "$FILEPATH" <<EOF2
---
title: "$POST_TITLE"
description: "Short summary of your post."
pubDate: '$DATE'
tags:
  - blog
category: tech
---

# $POST_TITLE

Write your post content here.
EOF2

echo "[+] Created new post: $FILEPATH"
